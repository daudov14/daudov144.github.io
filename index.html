<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ò–≥—Ä–∞ —Å –∞—Ä–∞–±—Å–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏</title>
<style>
  .visible { display: block; }
  .hidden { display: none; }

  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  section {
    margin-bottom: 20px;
  }

  button {
    margin: 5px 5px 5px 0;
    padding: 8px 12px;
    cursor: pointer;
  }

  .option-btn {
    margin: 5px;
    padding: 10px 15px;
    font-size: 1rem;
  }

  .option-btn.correct {
    background-color: #4caf50;
    color: white;
  }

  .option-btn.wrong {
    background-color: #f44336;
    color: white;
  }

  .word-item {
    padding: 5px;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
  }

  .word-item:hover, .word-item:focus {
    background-color: #f0f0f0;
    outline: none;
  }
</style>
</head>
<body>
<main>
  <!-- –°–µ–∫—Ü–∏—è –≤—Ö–æ–¥–∞ -->
  <section id="loginSection" class="visible">
    <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="usernameInput" type="text" placeholder="–õ–æ–≥–∏–Ω" />
    <input id="passwordInput" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button id="loginBtn">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <div id="loginMessage" style="color: red; margin-top: 10px;"></div>
  </section>

  <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
  <section id="menu" class="hidden">
    <h2>–ú–µ–Ω—é</h2>
    <button id="btnWords">–í—Å–µ —Å–ª–æ–≤–∞</button>
    <button id="btnGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

    <h3>–†–µ–∫–æ—Ä–¥—ã –∏–≥—Ä–æ–∫–æ–≤</h3>
    <table style="width: 100%; font-size: 12px;">
      <thead><tr><th>–ò–≥—Ä–æ–∫</th><th>–û—á–∫–∏</th></tr></thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </section>

  <!-- –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ -->
  <section id="wordsSection" class="hidden" aria-live="polite">
    <h2>–°–ª–æ–≤–∞</h2>
    <div id="wordsList" role="list" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 5px;"></div>
    <div>
      <span id="translation" style="font-weight: bold; margin-right: 10px;"></span>
      <button id="playAudio" style="display:none;">üîä –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏</button>
    </div>
    <button id="backFromWords">–ù–∞–∑–∞–¥</button>
  </section>

  <!-- –ò–≥—Ä–∞ -->
  <section id="gameSection" class="hidden" aria-live="assertive">
    <h2>–ò–≥—Ä–∞</h2>
    <div>–ê—Ä–∞–±—Å–∫–æ–µ —Å–ª–æ–≤–æ: <span id="gameWord" style="font-size: 2rem;"></span></div>
    <div id="gameOptions" style="margin-top: 15px;"></div>
    <div style="margin-top: 15px;">
      <span id="score">–û—á–∫–∏: 0</span> | <span id="bestScore">–õ—É—á—à–∏–π: 0</span> | –í—Ä–µ–º—è: <span id="timer">15</span> —Å–µ–∫
    </div>
    <button id="backFromGame" style="margin-top: 10px;">–í –º–µ–Ω—é</button>
  </section>
</main>

<script>
// ==== –î–∞–Ω–Ω—ã–µ —Å–ª–æ–≤ ====
const words = [
  { arabic: "ŸÉÿ™ÿßÿ®", translation: "–ö–Ω–∏–≥–∞" },
  { arabic: "ŸÇŸÑŸÖ", translation: "–†—É—á–∫–∞" },
  { arabic: "ŸÖÿØÿ±ÿ≥ÿ©", translation: "–®–∫–æ–ª–∞" },
  { arabic: "ÿ®ÿßÿ®", translation: "–î–≤–µ—Ä—å" },
  { arabic: "ÿ¥ŸÖÿ≥", translation: "–°–æ–ª–Ω—Ü–µ" },
  { arabic: "ŸÇŸÖÿ±", translation: "–õ—É–Ω–∞" },
  { arabic: "ÿ®Ÿäÿ™", translation: "–î–æ–º" },
  { arabic: "ŸÖÿßÿ°", translation: "–í–æ–¥–∞" }
];

// ==== –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã ====
const loginSection = document.getElementById('loginSection');
const menuSection = document.getElementById('menu');
const wordsSection = document.getElementById('wordsSection');
const gameSection = document.getElementById('gameSection');
const loginMessage = document.getElementById('loginMessage');

const usernameInput = document.getElementById('usernameInput');
const passwordInput = document.getElementById('passwordInput');
const loginBtn = document.getElementById('loginBtn');

const btnWords = document.getElementById('btnWords');
const btnGame = document.getElementById('btnGame');

const wordsList = document.getElementById('wordsList');
const translationSpan = document.getElementById('translation');
const playAudioBtn = document.getElementById('playAudio');
const backFromWords = document.getElementById('backFromWords');

const gameWordSpan = document.getElementById('gameWord');
const gameOptionsDiv = document.getElementById('gameOptions');
const scoreSpan = document.getElementById('score');
const bestScoreSpan = document.getElementById('bestScore');
const timerSpan = document.getElementById('timer');
const backFromGame = document.getElementById('backFromGame');

const leaderboardBody = document.getElementById('leaderboardBody');

// ==== –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ====
let currentUser = null;
let currentScore = 0;
let bestScore = 0;
let timerId = null;
let timeLeft = 15;
let currentQuestion = null;

// ==== –§—É–Ω–∫—Ü–∏–∏ ====

// –†–∞–±–æ—Ç–∞ —Å localStorage –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–∫–æ—Ä–¥–æ–≤
function loadUsers() {
  return JSON.parse(localStorage.getItem('users')) || {};
}

function saveUsers(users) {
  localStorage.setItem('users', JSON.stringify(users));
}

function loadLeaderboard() {
  return JSON.parse(localStorage.getItem('leaderboard')) || {};
}

function saveLeaderboard(board) {
  localStorage.setItem('leaderboard', JSON.stringify(board));
}

// –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
function updateLeaderboardUI() {
  let leaderboard = loadLeaderboard();
  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –º–∞—Å—Å–∏–≤ –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –æ—á–∫–∞–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
  const sorted = Object.entries(leaderboard).sort((a,b) => b[1] - a[1]);
  leaderboardBody.innerHTML = '';
  for (const [user, score] of sorted) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${user}</td><td>${score}</td>`;
    leaderboardBody.appendChild(tr);
  }
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –≤—Ö–æ–¥
loginBtn.onclick = () => {
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  if (!username || !password) {
    loginMessage.textContent = "–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å";
    return;
  }
  const users = loadUsers();
  if (users[username]) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    if (users[username].password === password) {
      currentUser = username;
      bestScore = users[username].bestScore || 0;
      loginMessage.textContent = "";
      showMenu();
    } else {
      loginMessage.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å";
    }
  } else {
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    users[username] = { password: password, bestScore: 0 };
    saveUsers(users);
    currentUser = username;
    bestScore = 0;
    loginMessage.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!";
    showMenu();
  }
};

// –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é
function showMenu() {
  loginSection.classList.add('hidden');
  menuSection.classList.remove('hidden');
  wordsSection.classList.add('hidden');
  gameSection.classList.add('hidden');
  currentScore = 0;
  scoreSpan.textContent = "–û—á–∫–∏: 0";
  bestScoreSpan.textContent = "–õ—É—á—à–∏–π: " + bestScore;
  updateLeaderboardUI();
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤
btnWords.onclick = () => {
  menuSection.classList.add('hidden');
  wordsSection.classList.remove('hidden');
  gameSection.classList.add('hidden');
  loginSection.classList.add('hidden');
  showWordsList();
  translationSpan.textContent = "";
  playAudioBtn.style.display = 'none';
};

backFromWords.onclick = () => {
  showMenu();
};

function showWordsList() {
  wordsList.innerHTML = "";
  words.forEach((w, i) => {
    const div = document.createElement('div');
    div.classList.add('word-item');
    div.setAttribute('tabindex', '0');
    div.textContent = w.arabic;
    div.onclick = () => {
      translationSpan.textContent = w.translation;
      playAudioBtn.style.display = 'inline-block';
      playAudioBtn.onclick = () => {
        speak(w.arabic);
      };
    };
    div.onkeydown = (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        div.click();
      }
    };
    wordsList.appendChild(div);
  });
}

// –û–∑–≤—É—á–∫–∞ (–±—Ä–∞—É–∑–µ—Ä–Ω–∞—è)
function speak(text) {
  if (!window.speechSynthesis) return;
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'ar-SA';
  speechSynthesis.speak(utterance);
}

// –ò–≥—Ä–∞
btnGame.onclick = () => {
  menuSection.classList.add('hidden');
  wordsSection.classList.add('hidden');
  gameSection.classList.remove('hidden');
  loginSection.classList.add('hidden');
  startGame();
};

backFromGame.onclick = () => {
  stopGame();
  showMenu();
};

function startGame() {
  currentScore = 0;
  scoreSpan.textContent = "–û—á–∫–∏: 0";
  bestScoreSpan.textContent = "–õ—É—á—à–∏–π: " + bestScore;
  timeLeft = 15;
  timerSpan.textContent = timeLeft;
  nextQuestion();
  startTimer();
}

function stopGame() {
  clearInterval(timerId);
}

function startTimer() {
  clearInterval(timerId);
  timeLeft = 15;
  timerSpan.textContent = timeLeft;
  timerId = setInterval(() => {
    timeLeft--;
    timerSpan.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timerId);
      alert("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.");
      endGame();
    }
  }, 1000);
}

function nextQuestion() {
  if (words.length < 4) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–≤ –¥–ª—è –∏–≥—Ä—ã.");
    endGame();
    return;
  }
  // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
  currentQuestion = words[Math.floor(Math.random() * words.length)];
  gameWordSpan.textContent = currentQuestion.arabic;

  // –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  let options = [currentQuestion];
  while (options.length < 4) {
    const candidate = words[Math.floor(Math.random() * words.length)];
    if (!options.includes(candidate)) options.push(candidate);
  }
  // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
  options.sort(() => Math.random() - 0.5);

  gameOptionsDiv.innerHTML = '';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.textContent = opt.translation;
    btn.onclick = () => {
      if (opt === currentQuestion) {
        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        currentScore++;
        scoreSpan.textContent = "–û—á–∫–∏: " + currentScore;
        timeLeft = 15; // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
        timerSpan.textContent = timeLeft;
        nextQuestion();
      } else {
        // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç - –∑–≤—É–∫ –∏ –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
        playWrongSound();
        alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.");
        endGame();
      }
    };
    gameOptionsDiv.appendChild(btn);
  });
}

// –ó–≤—É–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
function playWrongSound() {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = "sawtooth";
  o.frequency.value = 200;
  o.connect(g);
  g.connect(ctx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.5);
  setTimeout(() => { o.stop(); ctx.close(); }, 500);
}

// –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
function endGame() {
  clearInterval(timerId);
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ—Ä–¥ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  if (currentScore > bestScore) {
    bestScore = currentScore;
    const users = loadUsers();
    if (users[currentUser]) {
      users[currentUser].bestScore = bestScore;
      saveUsers(users);
    }
  }
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
  const leaderboard = loadLeaderboard();
  if (!leaderboard[currentUser] || leaderboard[currentUser] < currentScore) {
    leaderboard[currentUser] = currentScore;
    saveLeaderboard(leaderboard);
  }
  updateLeaderboardUI();
  alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –í–∞—à —Å—á–µ—Ç: " + currentScore);
  showMenu();
}

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.onload = () => {
  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–æ—Å–∏–º –≤–æ–π—Ç–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑
};
</script>

</body>
</html>